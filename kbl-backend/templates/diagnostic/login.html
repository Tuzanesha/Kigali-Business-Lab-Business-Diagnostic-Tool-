<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Login</title>
  <style>body{font-family:sans-serif;max-width:720px;margin:2rem auto}</style>
  <script>
    async function login(evt){
      evt.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const res = await fetch('/api/auth/login/',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});
      const resClone = res.clone();
      let data = null;
      try {
        data = await resClone.json();
      } catch (e) {
        const txt = await res.text().catch(()=> '');
        alert('Login error: '+(txt || 'unexpected response'));
        return;
      }
      if(res.ok){
        localStorage.setItem('access', data.access);
        localStorage.setItem('refresh', data.refresh);
        // Ask server if verified; redirect accordingly
        const chk = await fetch('/api/auth/status/', { headers: { 'Authorization': 'Bearer '+data.access, 'Content-Type':'application/json' } });
        const j = await chk.json();
        if (j && j.verified) { location.href = '/api/web/dashboard/'; }
        else { location.href = '/api/web/verify/'; }
      } else {
        alert('Login failed: '+(data.detail||JSON.stringify(data)));
      }
    }
  </script>
  </head>
<body>
  <h1>Login</h1>
  <form onsubmit="login(event)">
    <div><label>Email <input id="email" type="email" required /></label></div>
    <div><label>Password <input id="password" type="password" required /></label></div>
    <button type="submit">Log in</button>
  </form>
  <p><a href="/api/web/password-reset/">Forgot your password?</a></p>
  <p><a href="/api/web/signup/">Create an account</a></p>
</body>
</html>


