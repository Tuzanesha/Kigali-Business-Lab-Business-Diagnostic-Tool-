<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>New Enterprise</title>
  <style>body{font-family:sans-serif;max-width:720px;margin:2rem auto}</style>
  <script>
    async function callAPI(path, options={}){
      const token = localStorage.getItem('access');
      options.headers = Object.assign({'Content-Type':'application/json'}, options.headers||{});
      if(token){ options.headers['Authorization'] = 'Bearer '+token; }
      const res = await fetch(path, options);
      if(res.status===401){ location.href='/api/web/login/'; return; }
      return res.json();
    }
    function notify(msg){
      const n = document.getElementById('notice');
      n.textContent = msg||'';
      n.style.display = msg? 'block':'none';
    }
    async function submitForm(evt){
      evt.preventDefault();
      const body = Object.fromEntries(new FormData(evt.target).entries());
      body.status = 'draft';
      const res = await callAPI('/api/enterprises/', {method:'POST', body: JSON.stringify(body)});
      if(res && res.id){
        notify('Enterprise created.');
        location.href = '/api/web/dashboard/';
      } else {
        notify('Please fix the highlighted errors.');
        const err = res || {};
        for (const k in err){
          const el = document.querySelector(`[name="${k}"]`);
          if(el){ el.style.borderColor = 'red'; }
        }
      }
    }
  </script>
</head>
<body>
  <h1>Create Enterprise</h1>
  <div id="notice" style="display:none;background:#eef;padding:.5rem 1rem;margin:.5rem 0;border-left:3px solid #39f"></div>
  <form onsubmit="submitForm(event)">
    <div><label>Name <input name="name" required /></label></div>
    <div><label>Email <input name="email" type="email" required /></label></div>
    <div><label>Location <input name="location" required /></label></div>
    <div><label>Contact <input name="contact_person" required /></label></div>
    <div><label>Phone <input name="phone_number" required /></label></div>
    <div><label>Year Founded <input name="year_founded" type="number" required /></label></div>
    <div><label>Legal Structure <input name="legal_structure" required /></label></div>
    <div><label>Owner Background <input name="owner_background" required /></label></div>
    <div><label>Description <input name="description" required /></label></div>
    <div><label>Key Partners <input name="key_partners" required /></label></div>
    <div><label>FT Employees (total) <input name="full_time_employees_total" type="number" value="0" required /></label></div>
    <div><label>FT Employees (female) <input name="full_time_employees_female" type="number" value="0" required /></label></div>
    <div><label>PT Employees (total) <input name="part_time_employees_total" type="number" value="0" required /></label></div>
    <div><label>PT Employees (female) <input name="part_time_employees_female" type="number" value="0" required /></label></div>
    <div><label>Revenue This Year (USD) <input name="revenue_this_year" type="number" step="0.01" required /></label></div>
    <div><label>Revenue Last Year (USD) <input name="revenue_last_year" type="number" step="0.01" required /></label></div>
    <div><label>Units Sold This Year <input name="units_sold_this_year" required /></label></div>
    <div><label>Units Sold Last Year <input name="units_sold_last_year" required /></label></div>
    <div><label>Suppliers (count) <input name="num_suppliers" type="number" required /></label></div>
    <div><label>Customers (count) <input name="num_customers" type="number" required /></label></div>
    <div><label>Total Funding (USD) <input name="total_funding" type="number" step="0.01" required /></label></div>
    <div><label>Short-term Plans <input name="short_term_plans" required /></label></div>
    <div><label>Medium-term Plans <input name="medium_term_plans" required /></label></div>
    <div><label>Long-term Plans <input name="long_term_plans" required /></label></div>
    <div><label>Market Linkage Needs <input name="market_linkage_needs" required /></label></div>
    <div><label>Finance Needs Amount (USD) <input name="finance_needs_amount" type="number" step="0.01" required /></label></div>
    <div><label>Key Assistance Areas <input name="key_assistance_areas" required /></label></div>
    <button type="submit">Create</button>
  </form>
</body>
</html>


